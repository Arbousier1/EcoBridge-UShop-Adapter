name: Java CI with Maven (Paper 1.21.1)

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build:
    # 运行在 Linux 环境，对文件名大小写极其敏感
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: maven

    # 调试步骤：列出 libs 目录结构，确保文件已成功提交至 GitHub
    - name: Debug - List libs directory
      run: |
        echo "检查当前工作目录..."
        ls -R
        if [ -d "libs" ]; then
          echo "找到 libs 文件夹，内容如下:"
          ls -R libs/
        else
          echo "错误：找不到 libs 文件夹！请确认已执行 git add -f libs/*.jar"
          exit 1
        fi

    # 核心修正：自动定位并安装本地依赖
    # 无论你的 JAR 包在 libs 根目录还是嵌套文件夹内，此脚本都能找到它
    - name: Install Local Dependencies
      run: |
        ULTIMATE_PATH=$(find libs -name "UltimateShop-4.2.3.jar" | head -n 1)
        ECO_PATH=$(find libs -name "EcoBridge-1.0.jar" | head -n 1)

        echo "定位到 UltimateShop: $ULTIMATE_PATH"
        echo "定位到 EcoBridge: $ECO_PATH"

        if [ -z "$ULTIMATE_PATH" ] || [ -z "$ECO_PATH" ]; then
          echo "错误：无法在 libs 目录中定位 JAR 文件！"
          exit 1
        fi

        # 安装到 Runner 的本地 Maven 仓库
        mvn install:install-file -Dfile="$ULTIMATE_PATH" -DgroupId=
